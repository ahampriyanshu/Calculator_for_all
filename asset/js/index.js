var zip=new JSZip,totalLayout=38;function openClose(e,t,a){var n=document.getElementById(e);message=n.getElementsByClassName("message")[0],title=n.getElementsByClassName("modalTitle")[0],message.innerHTML=a,title.innerHTML=t,"none"===n.style.display?n.style.display="block":n.style.display="none"}function createSlide(){var e=document.getElementById("slidesDiv");for(var t=1;t<=totalLayout;t++){var a=document.createElement("div");a.setAttribute("class","mySlides hidden"),e.appendChild(a);var n=document.createElement("img");n.setAttribute("src","asset/sample/"+t+".png"),n.setAttribute("class","description w-full object-cover"),n.setAttribute("alt","Sample Layout "+t),n.setAttribute("onclick","currentSlide("+t+")"),a.appendChild(n)}}createSlide();var slideIndex=1;function plusSlides(e){showSlides(slideIndex+=e)}function currentSlide(e){showSlides(slideIndex=e)}function showSlides(e){var t,a=document.getElementsByClassName("mySlides"),n=document.getElementsByClassName("description"),i=document.getElementById("caption");for(e>a.length&&(slideIndex=1),e<1&&(slideIndex=a.length),t=0;t<a.length;t++)a[t].style.display="none";for(t=0;t<n.length;t++)n[t].className=n[t].className.replace(" opacity-100","");a[slideIndex-1].style.display="block",n[slideIndex-1].className+=" opacity-100",i.innerHTML=n[slideIndex-1].alt}showSlides(slideIndex);const file=document.querySelector("#file");file.addEventListener("change",e=>{const[t]=e.target.files;var{name:a,size:n}=t;const i=(n/1e3).toFixed(2);a.length>12&&(a=a.slice(0,12)+"...");const o=` ${a}  ${i} KB`;document.querySelector(".file-name").textContent=o});var navMenuDiv=document.getElementById("nav-content"),navMenu=document.getElementById("nav-toggle");function check(e){var t=e&&e.target;checkParent(t,navMenuDiv)||(checkParent(t,navMenu)&&navMenuDiv.classList.contains("hidden")?navMenuDiv.classList.remove("hidden"):navMenuDiv.classList.add("hidden"))}function checkParent(e,t){for(;e.parentNode;){if(e==t)return!0;e=e.parentNode}return!1}document.onclick=check;const generatePDF=async(e,t,a,n,i,o,l,r,s)=>{try{if(null===r||""===r||r>totalLayout||r<1||isNaN(r))throw"Invalid Layout Number";null!==i&&""!==i||(i="asset/sign.png");const u="asset/layout/"+parseInt(r)+".pdf",g=await fetch(u).then(e=>e.arrayBuffer()),m=await PDFDocument.load(g);m.registerFontkit(fontkit);const p=await fetch("./asset/font/BebasNeue-Regular.ttf").then(e=>e.arrayBuffer()),f=await fetch(i).then(e=>e.arrayBuffer()),y=await m.embedPng(f),h=(y.scale(.5),await m.embedFont(p)),w=m.getPages()[0],{width:v}=w.getSize(),x=60,B=45,S=30,b=15,E=h.widthOfTextAtSize(e,B),z=h.widthOfTextAtSize(t,x),D=h.widthOfTextAtSize(a,S),I=h.widthOfTextAtSize(n,b),L=h.widthOfTextAtSize(o,b),C=h.widthOfTextAtSize(l,b);w.drawText(a,{x:(v-D)/2,y:480,size:30,font:h,color:rgb(1,.6,.3)}),w.drawText(t,{x:(v-z)/2,y:380,size:x,font:h,color:rgb(1,.6,.3)}),w.drawText(e,{x:(v-E)/2,y:300,size:B,font:h,color:rgb(1,.6,.3)}),w.drawText(n,{x:(v-I)/2,y:250,font:h,size:b,color:rgb(0,0,0)}),w.drawImage(y,{x:v/2-75,y:128,width:150,height:100}),w.drawText(o,{x:(v-L)/2,y:108,font:h,size:b}),w.drawText(l,{x:(v-C)/2,y:83,font:h,size:b});var c=e+"_"+s+"_"+String(Date.now())+".pdf";const F=await m.save();var d=new File([F],c,{type:"application/pdf;charset=utf-8"});return zip.file(c,d),{output:!0,message:null}}catch(e){return{output:!1,message:e}}};window.addEventListener("load",function(){document.getElementById("upload").addEventListener("click",function(){var e=document.getElementById("file");if(null!==e.value&&""!==e.value){if(/.+\.(xlsx|xls)$/i.test(e.value.toLowerCase()))try{var t=new FileReader;t.readAsBinaryString?(t.onload=function(e){a(e.target.result)},t.readAsBinaryString(e.files[0])):(t.onload=function(e){for(var t="",n=new Uint8Array(e.target.result),i=0;i<n.byteLength;i++)t+=String.fromCharCode(n[i]);a(t)},t.readAsArrayBuffer(e.files[0]))}catch(e){openClose("alertBox","Browser Not Supported","Please update/ change your browser")}else openClose("alertBox","Error occured while uploading xlsx","Please upload a valid file or try renaming the file")}else openClose("alertBox","No file selected","Please upload a valid .xlsx/.xls file");function a(e){try{var t,a=XLSX.read(e,{type:"binary"}),n=100000000007,i=0,o=0,l=a.SheetNames[0],r=XLSX.utils.sheet_to_row_object_array(a.Sheets[l]),s=r.length;if(null===s||s<1||isNaN(s))throw"Empty Excel File";for(t=0;t<s;t++){generatePDF(r[t].Participant,r[t].Title,r[t].Organisation,r[t].Event,r[t].Sign,r[t].Name,r[t].Designation,r[t].Layout,t).then(function(e){e.output?++i===s&&(zipPDF(zip),openClose("successBox","All "+i+" certificates generated successfully","Liked the project? Star the repo on GitHub , that would really motivate me.")):(0===o&&(n=i),i+ ++o===s&&(zipPDF(zip),openClose("alertBox",o+" certificates couldn't be generated","First error occured at row "+n+" Error Desc: <br>"+e.message)))},function(e){i+o===s&&openClose("alertBox","Fatal  error occured at row "+i+" while creating PDF",e)})}}catch(e){openClose("alertBox","Fatal error while creating PDF",e)}}})});const participantRaw=document.getElementById("participant"),titleRaw=document.getElementById("title"),organisationRaw=document.getElementById("organisation"),eventRaw=document.getElementById("event"),nameRaw=document.getElementById("name"),designationRaw=document.getElementById("designation"),layoutRaw=document.getElementById("layout"),submitBtn=document.getElementById("submitBtn"),{PDFDocument:PDFDocument,rgb:rgb,degrees:degrees}=PDFLib,capitalize=(e,t=!1)=>(t?e.toLowerCase():e).replace(/(?:^|\s|["'([{])+\S/g,e=>e.toUpperCase());function zipPDF(e){e.generateAsync({type:"blob"}).then(function(e){saveAs(e,"bulky_"+Date.now()+".zip")}),e.files={}}submitBtn.addEventListener("click",()=>{const e=capitalize(participantRaw.value),t=capitalize(titleRaw.value),a=capitalize(organisationRaw.value),n=eventRaw.value,i=capitalize(nameRaw.value),o=designationRaw.value;var l=layoutRaw.value;(null===l||""===l||l>totalLayout||l<1||isNaN(l))&&(l=Math.floor(Math.random()*totalLayout+1)),generatePDF(e,t,a,n,"asset/sign.png",i,o,l,1).then(function(e){e.output?(zipPDF(zip),openClose("successBox","Certificate generated successfully via html form","Liked the project? Star the repo on GitHub , that would really motivate me.")):openClose("alertBox","Error occured while creating PDF",e.message)},function(e){openClose("alertBox","Error occured while creating PDF",e)})});